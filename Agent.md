# PRD: 최소 웹서버(회원가입/로그인 + 로그인 후 메인 화면)

**파일 경로/이름(권장):** `/tasks/prd-auth-minimal-local-webserver.md`

---

## 1) 개요(Overview)

* **목표:** 로컬 PC에서 실행 가능한 가장 단순한 웹서버를 구축한다. 사용자는 회원가입과 로그인 기능을 통해 인증을 완료하면 메인 화면(보호 라우트)에 접근할 수 있다. 초기 버전은 최소 기능에 집중하고, 이후 메인 화면에 기능을 점진적으로 확장할 수 있도록 구조를 단순/명확하게 잡는다.
* **배경/가치:** 인증 흐름이 갖춰진 최소 골격을 먼저 확보하면, 이후 모듈(예: 대시보드 위젯, 알림, 프로필 관리)을 쉽게 추가할 수 있다.

---

## 2) 범위(Scope)

* **포함:**

  * 회원가입(이메일/비밀번호) + 로그인/로그아웃
  * 로그인 성공 시 메인 화면(보호 라우트) 접근
  * 확장을 염두에 둔 간단한 프로젝트 구조 및 모듈화 초석
* **제외(초기):**

  * 이메일 인증(Email verification)
  * 비밀번호 재설정/찾기
  * 소셜 로그인(OAuth)
  * 관리자 기능, 권한(Role) 분리

---

## 3) 사용자 스토리(User Stories)

1. **신규 사용자**로서, 이메일과 비밀번호로 **간단히 회원가입**해서 서비스를 이용 시작하고 싶다.
2. **기존 사용자**로서, 이메일/비밀번호로 **로그인**해 **메인 화면**에 접근하고 싶다.
3. **인증되지 않은 사용자**로서, 보호된 페이지에 접근하려 하면 **로그인 페이지로 리다이렉트**되어야 한다.
4. **로그인한 사용자**로서, 우측 상단(또는 명확한 위치)의 **로그아웃 버튼**으로 세션을 종료하고 공개 페이지로 돌아가고 싶다.

---

## 4) 기능 요구사항(Functional Requirements)

**인증/계정**

1. 시스템은 사용자가 **이메일 + 비밀번호**로 회원가입할 수 있어야 한다.
2. 시스템은 회원가입 시 비밀번호를 **해시**(bcrypt)하여 저장해야 한다.
3. 시스템은 사용자가 **이메일 + 비밀번호**로 로그인할 수 있어야 한다.
4. 시스템은 로그인 성공 시 서버 세션을 생성하고, **세션/쿠키 기반 인증**으로 사용자 상태를 유지해야 한다.
5. 시스템은 잘못된 자격 증명(없는 이메일 또는 틀린 비밀번호)일 때 **일반화된 오류 메시지**를 반환해야 한다(보안상 세부 불노출).
6. 시스템은 **로그아웃** 기능을 제공해야 한다(세션 무효화).

**라우팅/화면**
7. 시스템은 **로그인 페이지**와 **회원가입 페이지**를 제공해야 한다.
8. 시스템은 로그인 완료 사용자만 접근 가능한 **메인 화면(보호 라우트)** 를 제공해야 한다.
9. 비인증 사용자가 보호 라우트로 접근 시 **로그인 페이지로 리다이렉트**해야 한다.

**UX/유효성 검증**
10. 클라이언트/서버 양쪽에서 **기본 입력 검증**을 수행해야 한다(이메일 형식, 비밀번호 최소 길이 8자 등).
11. 폼 제출 실패 시 **간단한 에러 메시지**를 화면에 표시해야 한다.

**보안/기본 안정성**
12. 비밀번호는 **단방향 해시(bcrypt)** 로 저장되어야 한다.
13. 세션 쿠키는 **HTTP-only** 플래그를 갖고, 개발 모드에서는 Secure 플래그는 선택적이다(로컬 http 지원).
14. **기본 rate limiting**(예: IP당 로그인 시도 제한)을 적용해야 한다(개발 모드에서도 동작 가능).

---

## 5) 비기능 요구사항(Non-Functional)

* **단순성:** 로컬에서 `npm install && npm run dev` 수준으로 실행 가능.
* **가독성:** 주니어 개발자가 구조를 이해하기 쉬운 디렉터리 구성.
* **확장성:** 인증/사용자/웹 레이어를 느슨하게 분리해 향후 도메인 추가 용이.
* **테스트(선택):** 핵심 로직(해시/검증/미들웨어) 단위 테스트 최소 세트 권장.

---

## 6) 제안 기술 스택(초간단 로컬 우선)

* **런타임/프레임워크:** Node.js (LTS) + **Express**
* **템플릿 엔진(UI 최소):** **EJS** (SSR, 폼 제출 간단)
* **DB:** **SQLite** (파일 기반, 개발에 적합) — Node 모듈 `better-sqlite3` 또는 `sqlite3`
* **세션:** `express-session` + 메모리 스토어(개발) → 추후 SQLite/Redis로 전환 가능
* **비밀번호 해시:** `bcrypt`
* **입력 검증:** `zod` 또는 `express-validator` (간단 규칙)
* **Rate limiting:** `express-rate-limit`
* **로깅:** 기본 콘솔 로그(요청/오류)
* **환경설정:** `.env` + `.env.example`

> 이유: Express + EJS + SQLite는 의존성/학습비용이 낮고, 로컬 구동과 최소 기능 구현에 적합. 이후 React/Next.js로 프론트 교체도 용이.

---

## 7) 정보 구조/라우팅 구조(초안)

* **공개 라우트**

  * `GET /` : 랜딩(로그인/회원가입 링크)
  * `GET /login` : 로그인 폼
  * `POST /login` : 로그인 처리
  * `GET /signup` : 회원가입 폼
  * `POST /signup` : 회원가입 처리
  * `POST /logout` : 로그아웃 처리
* **보호 라우트(인증 필요)**

  * `GET /main` : 메인 화면(“환영합니다, {email 또는 닉네임}”) — 이후 위젯/카드 추가 예정

---

## 8) 화면/UX 스케치(텍스트)

* **로그인 페이지**: 이메일, 비밀번호, 로그인 버튼. 하단에 회원가입 링크.
* **회원가입 페이지**: 이메일, 비밀번호, 비밀번호 확인, 가입 버튼. 성공 시 로그인 페이지로 안내.
* **메인 화면**: 상단 바(우측 `로그아웃`), 본문에 환영 메세지와 “곧 추가될 위젯 영역” 더미 카드 1–2개.

---

## 9) 데이터 모델(초기)

* **users**

  * `id` (INTEGER, PK, auto-increment)
  * `email` (TEXT, UNIQUE, NOT NULL)
  * `password_hash` (TEXT, NOT NULL)
  * `created_at` (DATETIME)

---

## 10) 성공 지표(Success Metrics)

* 로컬에서 신규 설치자가 **5분 이내**에 서버 구동 및 회원가입/로그인/메인 접근까지 완료
* 기본 공격(무차별 대입)에 대한 rate limiting 적용 확인

---

## 11) 향후 확장 고려사항(Backlog/Expansion)

* 비밀번호 재설정(토큰 메일)
* 이메일 검증
* 소셜 로그인(구글/깃허브)
* 역할/권한(Role) 기반 접근 제어
* 메인 화면: 위젯 시스템(카드, 메뉴, 공지, 활동 로그 등)
* 로그/감사 기록, 요청 ID
* Dockerfile, 배포 스크립트

---

## 12) 오픈 이슈(Open Questions)

1. 메인 화면의 기본 레이아웃(상단바/사이드바)까지 잡을지, 환영 문구만으로 시작할지? → **초기: 환영 문구 + 더미 카드 1개** 제안
2. 비밀번호 정책(특수문자/대문자 필수 여부) 강도 수준? → **최소 8자**로 시작
3. Rate limit 기본값(분당 N회) 결정? → **예: `/login` 5회/분/IP**
4. 테스트 범위: 단위 테스트 어떤 수준까지 포함할지? → **미들웨어/해시 유닛테스트 최소** 권장

---

## 13) 승인(Approval)

* 본 PRD는 최소 실행 가능한 기능(MVP)을 정의한다. 필요 시 본 문서에 코멘트로 수정/보완 후 확정.
